AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: >
  excel-competencies-tracking

  In API Gateway, this API is called 'excel-competencies-tracking-sam-app'

  SAM Template for excel-competencies-tracking repo (https://github.com/walkman1915/excel-competencies-tracking).
  Junior Design project for team JD 9350.

Globals:
  Function:
    Timeout: 3
Resources:
  GetCompetencyFunction:
    Type: AWS::Serverless::Function # https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html
    Properties:
      CodeUri: functions/competency/
      Handler: app.lambdaHandler
      Runtime: nodejs12.x
      Events:
        GetCompetency:
          Type: Api
          Properties:
            Path: /competency
            Method: get

  CompetenciesMasterDDBTable: # Master table to store info about each competency
    Type: AWS::DynamoDB::Table
    Properties: 
      AttributeDefinitions: 
        - 
          AttributeName: "CompetencyId"
          AttributeType: "S"
      KeySchema: 
        - 
          AttributeName: "CompetencyId"
          KeyType: "HASH"
      ProvisionedThroughput: 
        ReadCapacityUnits: "5"
        WriteCapacityUnits: "5"
      TableName: "CompetenciesMaster"

Outputs: # These outputs are just for our benefit if we want quick access to the ARNs or HTTP address.
         # They're shown in the console after a successful 'sam deploy'
  ExcelCompetenciesTrackingApi:
    Description: API Gateway endpoint URL for Prod stage for Excel Competencies Tracking project
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/
  GetCompetencyFunction: # For consistency's sake, keep this name the same as the function's resource name above
    Description: Get Competency Lambda Function ARN
    Value:
      Fn::GetAtt:
      - GetCompetencyFunction
      - Arn
  GetCompetencyFunctionIamRole: # This must literally be {function's resource name} + "IamRole"
    Description: Implicit IAM Role created for Get Competency function
    Value:
      Fn::GetAtt:
      - GetCompetencyFunctionRole
      - Arn
  CompetenciesMasterDDBTable:
    Description: Competencies Master Dynamo DB Table ARN
    Value: !GetAtt CompetenciesMasterDDBTable.Arn